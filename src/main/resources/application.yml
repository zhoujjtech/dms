server:
  port: 8080

spring:
  application:
    name: dms-liteflow
  datasource:
    url: jdbc:mysql://localhost:3306/dms_liteflow?useUnicode=true&characterEncoding=utf8&serverTimezone=Asia/Shanghai
    username: root
    password: root
    driver-class-name: com.mysql.cj.jdbc.Driver
    hikari:
      maximum-pool-size: 20
      minimum-idle: 5
  jpa:
    hibernate:
      ddl-auto: update
    show-sql: false
    database-platform: org.hibernate.dialect.MySQL8Dialect

liteflow:
  # 规则源配置
  rule-source:
    # XML 文件配置路径（核心稳定流程）
    configData: classpath:flow/
    # 数据库动态加载（可变业务规则）
    script-file-function-data:
      enabled: true
      # SQL 查询语句
      sql: SELECT rule_content FROM flow_chain WHERE chain_code = ? AND status = 'ACTIVE' AND deleted_at IS NULL
  # 组件扫描路径
  source: com.dms.liteflow.component
  # 启用监控
  monitoring:
    enabled: true
    # 监控数据采集
    collect:
      # 是否采集执行时间
      collectTime: true
      # 是否采集执行路径
      collectPath: true
      # 是否采集异常信息
      collectError: true
  # 事务配置
  transaction:
    enabled: true
    # 事务管理器
    manager: springTransactionManager
    # 默认事务传播行为
    default-propagation: REQUIRED
    # 默认事务超时时间（秒）
    default-timeout: 30

# Actuator 配置
management:
  endpoints:
    web:
      exposure:
        include: health,info,metrics
  endpoint:
    health:
      show-details: always

# 日志配置
logging:
  level:
    com.dms.liteflow: debug
    com.yomahub.liteflow: info
  pattern:
    console: '%d{yyyy-MM-dd HH:mm:ss.SSS} [%thread] %-5level %logger{36} - %msg%n'

# 缓存配置
caffeine:
  cache:
    # 配置缓存
    config:
      maximum-size: 1000
      expire-after-write: 5m
    # 组件缓存
    component:
      maximum-size: 500
      expire-after-write: 30m

# 告警配置
alert:
  enabled: true
  # 失败率阈值（百分比）
  failure-rate-threshold: 5
  # 告警频率控制（分钟）
  alert-frequency: 30
  # 邮件配置
  email:
    enabled: false
    from: admin@dms.com
    to: admin@dms.com
  # 钉钉配置
  dingtalk:
    enabled: false
    webhook: https://oapi.dingtalk.com/robot/send
    secret: ""
  # 企业微信配置
  wecom:
    enabled: false
    webhook: https://qyapi.weixin.qq.com/cgi-bin/webhook/send
    key: ""
