## ADDED Requirements

### Requirement: 支持配置自动轮询刷新
系统 SHALL 支持 LiteFlow SQL 插件的轮询自动刷新机制，定期检查数据库配置变更。

#### Scenario: 启用轮询刷新机制
- **WHEN** 应用启动并启用轮询刷新
- **THEN** 系统每 60 秒（可配置）检查一次数据库配置变更
- **AND** 系统通过 SHA 值比对判断配置是否发生变更
- **AND** 系统仅在配置发生变更时重新加载规则

#### Scenario: 轮询间隔可配置
- **WHEN** 管理员配置轮询间隔参数
- **THEN** 系统支持通过 `liteflow.rule-source-ext-data-map.pollingIntervalSeconds` 配置间隔时间
- **AND** 默认间隔为 60 秒
- **AND** 系统支持通过 `liteflow.rule-source-ext-data-map.pollingStartSeconds` 配置首次轮询延迟时间
- **AND** 默认首次延迟为 60 秒

### Requirement: 配置变更热更新
系统 SHALL 在检测到数据库配置变更时，自动刷新 LiteFlow 引擎的规则配置，无需重启应用。

#### Scenario: 流程链配置变更时自动刷新
- **WHEN** 数据库中的流程链配置发生变更（新增、修改、删除）
- **THEN** 系统在下一个轮询周期检测到变更
- **AND** 系统自动重新加载流程链配置
- **AND** LiteFlow 引擎使用新配置处理后续请求
- **AND** 正在执行的流程使用旧配置继续执行

#### Scenario: 组件配置变更时自动刷新
- **WHEN** 数据库中的组件配置发生变更
- **THEN** 系统在下一个轮询周期检测到变更
- **AND** 系统自动重新加载组件配置
- **AND** LiteFlow 引擎使用新配置处理后续请求

### Requirement: 配置刷新事件通知
系统 SHALL 在配置刷新完成后记录日志和发送通知。

#### Scenario: 配置刷新成功时记录日志
- **WHEN** 配置刷新成功
- **THEN** 系统记录 INFO 级别日志
- **AND** 日志包含刷新的配置类型（流程链、组件）
- **AND** 日志包含刷新的配置数量
- **AND** 日志包含刷新的时间戳

#### Scenario: 配置刷新失败时记录错误
- **WHEN** 配置刷新失败（数据库异常、配置格式错误）
- **THEN** 系统记录 ERROR 级别日志
- **AND** 日志包含失败的详细信息
- **AND** 系统保持当前配置继续运行

### Requirement: 配置刷新不影响正在执行的任务
系统 SHALL 确保配置刷新不影响正在执行的流程任务。

#### Scenario: 刷新期间正在执行的任务不受影响
- **WHEN** 系统正在刷新配置
- **THEN** 正在执行的流程任务使用刷新前的配置继续执行
- **AND** 新的流程请求使用刷新后的配置
- **AND** 系统不中断或取消任何正在执行的任务

#### Scenario: 刷新失败不影响运行中的任务
- **WHEN** 配置刷新失败
- **THEN** 正在执行的流程任务继续使用当前配置
- **AND** 系统不中断或取消任何正在执行的任务
- **AND** 新的流程请求使用当前配置

### Requirement: 支持手动触发配置刷新
系统 SHALL 支持 API 接口手动触发配置刷新。

#### Scenario: 通过 API 手动刷新配置
- **WHEN** 管理员调用配置刷新 API 接口
- **THEN** 系统立即从数据库重新加载配置
- **AND** 系统清除配置缓存
- **AND** 系统返回刷新结果（成功/失败）

#### Scenario: 手动刷新指定租户的配置
- **WHEN** 管理员调用刷新 API 并指定租户ID
- **THEN** 系统仅刷新指定租户的配置
- **AND** 系统清除指定租户的配置缓存
- **AND** 其他租户的配置不受影响
